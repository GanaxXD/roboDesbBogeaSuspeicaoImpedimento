-- CONCLUSOS
	SELECT 
		DISTINCT 
		PROCESSO.NUMEROPROCESSOUNICO as numeroprocesso, 
		ARQUIVO_DOCUMENTO.CODDOCUMENTO AS idprocessodocumento,
		ARQUIVO_DOCUMENTO.DATAINSERCAO AS dtjuntada,
		DESCRICAO_TIPO_ARQUIVO.DESCRICAO AS dstipoprocessodocumento,  
		ARQUIVO_DOCUMENTO.CAMINHO AS nrdocumentostorage,
		'https://projudi.tjba.jus.br/projudi/listagens/DadosProcesso?numeroProcesso=' || to_char(PROCESSO.numeroprocesso) as linkProcesso
	FROM 
		ECNJ.CONCLUSAO,
		ECNJ.MOVIMENTACAO MOV_CONCLUSAO,
		ECNJ.MOVIMENTACAO MOV_DISTRIBUICAO,
		ECNJ.PROCESSO,
		ECNJ.ARQUIVO_DOCUMENTO,
		ECNJ.DESCRICAO_TIPO_ARQUIVO, 
		ECNJ.AREADEVARAS
	WHERE MOV_CONCLUSAO.NUMEROPROCESSO = PROCESSO.NUMEROPROCESSO
	AND MOV_CONCLUSAO.CODDOCUMENTO = CONCLUSAO.CODDOCABERTURA
	AND MOV_DISTRIBUICAO.NUMEROPROCESSO = PROCESSO.NUMEROPROCESSO
	AND MOV_DISTRIBUICAO.CODDOCUMENTO = ARQUIVO_DOCUMENTO.CODDOCUMENTO
	AND ARQUIVO_DOCUMENTO.CODIGOTIPOARQUIVO = DESCRICAO_TIPO_ARQUIVO.CODIGO
	AND PROCESSO.COD_AREA = AREADEVARAS.COD_AREA AND AREADEVARAS.COD_AREA = ?
	AND ARQUIVO_DOCUMENTO.CONTENTTYPE = 'application/pdf'
	AND DESCRICAO_TIPO_ARQUIVO.CODIGO = 30 -- PETICAO_INICIAL
	AND PROCESSO.DATAARQUIVAMENTO IS NULL
	AND PROCESSO.COD_VARA = ?
	AND MOV_DISTRIBUICAO.CODDESCREVEMOVIMENTACAO = 981 -- MOV RECEBIDO PELO DISTRIBUIDOR (ONDE FICA A PET INI)
	AND CONCLUSAO.DATACANCELAMENTO IS NULL
	AND CONCLUSAO.DATAANALISE IS NULL
	AND NOT EXISTS
	(
		SELECT 1 FROM ECNJ.PROCESSO p2 
		INNER JOIN ECNJ.LOCALIZADOR_PROCESSO ON LOCALIZADOR_PROCESSO.NUMEROPROCESSO = p2.NUMEROPROCESSO
		INNER JOIN ECNJ.TIPO_LOCALIZADOR ON TIPO_LOCALIZADOR.CODLOCALIZADOR = LOCALIZADOR_PROCESSO.CODLOCALIZADOR
		AND TIPO_LOCALIZADOR.DESCRICAO  LIKE 'IA_%'
		WHERE  p2.NUMEROPROCESSO= PROCESSO.NUMEROPROCESSO 
		AND TIPO_LOCALIZADOR.codvara = 0
		AND LOCALIZADOR_PROCESSO.DATAFECHAMENTO IS NULL
	)
	--AND processo.numeroprocessounico in ('0018699-80.2020.8.05.0080','0016459-21.2020.8.05.0080','0018022-50.2020.8.05.0080','0018268-46.2020.8.05.0080')
	UNION 
	--DISTRIBUIDOS
	SELECT 
		DISTINCT 
		PROCESSO.NUMEROPROCESSOUNICO as numeroprocesso, 
		ARQUIVO_DOCUMENTO.CODDOCUMENTO AS idprocessodocumento,
		ARQUIVO_DOCUMENTO.DATAINSERCAO AS dtjuntada,
		DESCRICAO_TIPO_ARQUIVO.DESCRICAO AS dstipoprocessodocumento,  
		ARQUIVO_DOCUMENTO.CAMINHO AS nrdocumentostorage,
		'https://projudi.tjba.jus.br/projudi/listagens/DadosProcesso?numeroProcesso=' || to_char(PROCESSO.numeroprocesso) as linkProcesso
	FROM 
		ECNJ.MOVIMENTACAO MOV_DISTRIBUICAO,
		ECNJ.PROCESSO,
		ECNJ.ARQUIVO_DOCUMENTO,
		ECNJ.DESCRICAO_TIPO_ARQUIVO, 
		ECNJ.AREADEVARAS
	WHERE MOV_DISTRIBUICAO.NUMEROPROCESSO = PROCESSO.NUMEROPROCESSO
	AND MOV_DISTRIBUICAO.CODDOCUMENTO = ARQUIVO_DOCUMENTO.CODDOCUMENTO
	AND ARQUIVO_DOCUMENTO.CODIGOTIPOARQUIVO = DESCRICAO_TIPO_ARQUIVO.CODIGO
	AND PROCESSO.COD_AREA = AREADEVARAS.COD_AREA AND AREADEVARAS.COD_AREA = ?
	AND ARQUIVO_DOCUMENTO.CONTENTTYPE = 'application/pdf'
	AND DESCRICAO_TIPO_ARQUIVO.CODIGO = 30 -- PETICAO_INICIAL
	AND PROCESSO.DATAARQUIVAMENTO IS NULL
	AND PROCESSO.COD_VARA = ?
	AND MOV_DISTRIBUICAO.CODDESCREVEMOVIMENTACAO = 981 -- MOV RECEBIDO PELO DISTRIBUIDOR (ONDE FICA A PET INI)
	AND NOT EXISTS
	(
		SELECT 1 FROM ECNJ.PROCESSO p2 
		INNER JOIN ECNJ.LOCALIZADOR_PROCESSO ON LOCALIZADOR_PROCESSO.NUMEROPROCESSO = p2.NUMEROPROCESSO
		INNER JOIN ECNJ.TIPO_LOCALIZADOR ON TIPO_LOCALIZADOR.CODLOCALIZADOR = LOCALIZADOR_PROCESSO.CODLOCALIZADOR
		AND TIPO_LOCALIZADOR.DESCRICAO  LIKE 'IA_%'
		WHERE  p2.NUMEROPROCESSO= PROCESSO.NUMEROPROCESSO 
		AND TIPO_LOCALIZADOR.codvara = 0
		AND LOCALIZADOR_PROCESSO.DATAFECHAMENTO IS NULL
	) 
	--AND processo.numeroprocessounico in ('0018699-80.2020.8.05.0080','0016459-21.2020.8.05.0080','0018022-50.2020.8.05.0080','0018268-46.2020.8.05.0080')
	AND	TRUNC(PROCESSO.DATARECEBIMENTO) > SYSDATE-1
	